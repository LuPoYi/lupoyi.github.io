<!DOCTYPE html>
<html lang='en'><head>
  <title>
      
      [Ubuntu] Ruby on Rails 基本環境建置 - Ubuntu 16.04 LTS - Bob 學習筆記
    
  </title>
  <link rel='canonical' href='https://blog.poyi.tw/blog/2016/11/26/rails-ubuntu-environment-ubuntu16-dot-04/' />
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <meta name='description' content='' />
  <meta name='theme-color' content='#FD3519' />
  
    <link rel="shortcut icon" href="/favicon.png" type="image/x-icon" />
    <link rel="icon" href="/favicon.png" type="image/x-icon" />
  

  <meta name="generator" content="Hugo 0.58.1" />

  





<link rel="stylesheet" href="https://blog.poyi.tw/sass/style.min.cf2eeff825d4dbc673ce0b82d270d9fc32d34973a7d5cd079e0dcf4fe3e77515.css" integrity="sha256-zy7v&#43;CXU28ZzzguC0nDZ/DLTSXOn1c0Hng3PT&#43;PndRU=" media="screen">
<link rel="stylesheet" href="https://blog.poyi.tw/syntax.min.css" integrity="" media="screen">

  <link rel="stylesheet" href="/stylesheets/custom.css" media="screen">

  <meta property="og:title" content="[Ubuntu] Ruby on Rails 基本環境建置 - Ubuntu 16.04 LTS" />
<meta property="og:description" content="# 建立user sudo adduser bob sudo adduser bob sudo su bob# 安裝常用lib sudo apt-get update sudo apt-get upgrade sudo apt-get install vim nodejs autoconf sudo apt-get install git-core curl zlib1g-dev build-essential libssl-dev libreadline-dev libyaml-dev libsqlite3-dev sqlite3 libxml2-dev libxslt1-dev libcurl4-openssl-dev python-software-properties libffi-dev Install Ruby &amp; Rails # 使用rbenv來管理ruby cd git clone https://github.com/rbenv/rbenv.git ~/.rbenv echo &#39;export PATH=&#34;$HOME/.rbenv/bin:$PATH&#34;&#39; &gt;&gt; ~/.bashrc echo &#39;eval &#34;$(rbenv init -)&#34;&#39; &gt;&gt; ~/.bashrc exec $SHELL git clone https://github.com/rbenv/ruby-build.git ~/." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.poyi.tw/blog/2016/11/26/rails-ubuntu-environment-ubuntu16-dot-04/" />
<meta property="article:published_time" content="2016-11-26T00:00:00+00:00" />
<meta property="article:modified_time" content="2016-11-26T00:00:00+00:00" />

  <meta itemprop="name" content="[Ubuntu] Ruby on Rails 基本環境建置 - Ubuntu 16.04 LTS">
<meta itemprop="description" content="# 建立user sudo adduser bob sudo adduser bob sudo su bob# 安裝常用lib sudo apt-get update sudo apt-get upgrade sudo apt-get install vim nodejs autoconf sudo apt-get install git-core curl zlib1g-dev build-essential libssl-dev libreadline-dev libyaml-dev libsqlite3-dev sqlite3 libxml2-dev libxslt1-dev libcurl4-openssl-dev python-software-properties libffi-dev Install Ruby &amp; Rails # 使用rbenv來管理ruby cd git clone https://github.com/rbenv/rbenv.git ~/.rbenv echo &#39;export PATH=&#34;$HOME/.rbenv/bin:$PATH&#34;&#39; &gt;&gt; ~/.bashrc echo &#39;eval &#34;$(rbenv init -)&#34;&#39; &gt;&gt; ~/.bashrc exec $SHELL git clone https://github.com/rbenv/ruby-build.git ~/.">


<meta itemprop="datePublished" content="2016-11-26T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2016-11-26T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="435">



<meta itemprop="keywords" content="ruby,rails," />

</head>

<body>

  <header style="background-image:linear-gradient(
      rgba(0,0,0,0.4),rgba(0,0,0,0.4)
    ),url(&#39;https://blog.poyi.tw/images/default-sidebar.jpg&#39;)">

  <div class="intro">
    <div class="logo-container">
      <a href="/">
        <img src='https://blog.poyi.tw/images/bob2.jpg' alt="Profile Categories" class="rounded-logo">
      </a>
    </div>
    <h2>Bob</h2>
    <h3>Software Engineer</h3>
    <div class="menu">
      

        <p>
            <a href="/posts/">
                Archive
            </a>
        </p>

        <p>
            <a href="/memo/">
                Memo
            </a>
        </p>

        <p>
            <a href="/about/">
                About
            </a>
        </p>

      
        
        <p>
            <a href="mailto:maydaybob2000@gmail.com" target="_blank" rel="external">
                
            </a>
        </p>
      
    </div>

  </div>

  <div class="socials">
      
  </div>

</header>

  <div class="content-wrapper">
    
      <div class="breadcrumb">
  





<span >
  <a href="https://blog.poyi.tw/">Bob 學習筆記</a>
   / 
</span>


<span >
  <a href="https://blog.poyi.tw/posts/">Posts</a>
   / 
</span>


<span  class="active">
  <a href="https://blog.poyi.tw/blog/2016/11/26/rails-ubuntu-environment-ubuntu16-dot-04/">[Ubuntu] Ruby on Rails 基本環境建置 - Ubuntu 16.04 LTS</a>
  
</span>

</div>

    
    <main id="content" class="posts">

<h1>[Ubuntu] Ruby on Rails 基本環境建置 - Ubuntu 16.04 LTS</h1>
<p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 建立user</span>
sudo adduser bob
sudo adduser bob sudo
su bob</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 安裝常用lib</span>
sudo apt-get update
sudo apt-get upgrade
sudo apt-get install vim nodejs autoconf
sudo apt-get install git-core curl zlib1g-dev build-essential libssl-dev libreadline-dev libyaml-dev libsqlite3-dev sqlite3 libxml2-dev libxslt1-dev libcurl4-openssl-dev python-software-properties libffi-dev</code></pre></div>
<h2 id="install-ruby-rails">Install Ruby &amp; Rails</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 使用rbenv來管理ruby</span>
<span class="nb">cd</span>
git clone <a href="https://github.com/rbenv/rbenv.git">https://github.com/rbenv/rbenv.git</a> ~/.rbenv
<span class="nb">echo</span> <span class="s1">&#39;export PATH=&#34;$HOME/.rbenv/bin:$PATH&#34;&#39;</span> &gt;&gt; ~/.bashrc
<span class="nb">echo</span> <span class="s1">&#39;eval &#34;$(rbenv init -)&#34;&#39;</span> &gt;&gt; ~/.bashrc
<span class="nb">exec</span> <span class="nv">$SHELL</span></p>

<p>git clone <a href="https://github.com/rbenv/ruby-build.git">https://github.com/rbenv/ruby-build.git</a> ~/.rbenv/plugins/ruby-build
<span class="nb">echo</span> <span class="s1">&#39;export PATH=&#34;$HOME/.rbenv/plugins/ruby-build/bin:$PATH&#34;&#39;</span> &gt;&gt; ~/.bashrc
<span class="nb">exec</span> <span class="nv">$SHELL</span></p>

<p>rbenv install <span class="m">2</span>.3.1
rbenv global <span class="m">2</span>.3.1
<span class="c1"># rbenv shell 2.3.1</span>
<span class="c1"># rbenv local 2.3.1</span>
<span class="c1"># rbenv global 2.3.1</span>
ruby -v</p>

<p><span class="c1"># rvm</span>
<span class="c1"># sudo apt-get install libgdbm-dev libncurses5-dev automake libtool bison libffi-dev</span>
<span class="c1"># gpg &ndash;keyserver hkp://keys.gnupg.net &ndash;recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3</span>
<span class="c1"># curl -sSL <a href="https://get.rvm.io">https://get.rvm.io</a> | bash -s stable</span>
<span class="c1"># source ~/.rvm/scripts/rvm</span>
<span class="c1"># rvm install 2.3.1</span>
<span class="c1"># rvm use 2.3.1 &ndash;default</span></p>

<p><span class="c1"># skip doc</span>
<span class="nb">echo</span> <span class="s2">&#34;gem: &ndash;no-ri &ndash;no-rdoc&#34;</span> &gt; ~/.gemrc</p>

<p>gem install bundler</code></pre></div>
<h2 id="install-passenger-nginx">Install Passenger &amp; Nginx</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># install nginx</span>
sudo apt-key adv &ndash;keyserver hkp://keyserver.ubuntu.com:80 &ndash;recv-keys 561F9B9CAC40B2F7
sudo apt-get install -y apt-transport-https ca-certificates</p>

<p><span class="c1"># Add Passenger APT repository</span>
sudo sh -c <span class="s1">&#39;echo deb <a href="https://oss-binaries.phusionpassenger.com/apt/passenger">https://oss-binaries.phusionpassenger.com/apt/passenger</a> xenial main &gt; /etc/apt/sources.list.d/passenger.list&#39;</span>
sudo apt-get update</p>

<p><span class="c1"># Install Passenger &amp; Nginx</span>
sudo apt-get install -y nginx-extras passenger</p>

<p>sudo service nginx start</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># /etc/nginx/nginx.conf</span>
<span class="c1">##</span>
<span class="c1"># Phusion Passenger</span>
<span class="c1">##</span>
<span class="c1"># Uncomment it if you installed ruby-passenger or ruby-passenger-enterprise</span>
<span class="c1">##</span></p>

<p>include /etc/nginx/passenger.conf<span class="p">;</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># /etc/nginx/passenger.conf</span>
<span class="c1"># 加上</span>
passenger_root /usr/lib/ruby/vendor_ruby/phusion_passenger/locations.ini<span class="p">;</span>
passenger_ruby /home/bob/.rbenv/shims/ruby<span class="p">;</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># /etc/nginx/sites-enabled/default</span>
server <span class="o">{</span>
        listen <span class="m">80</span> default_server<span class="p">;</span>
        listen <span class="o">[</span>::<span class="o">]</span>:80 default_server <span class="nv">ipv6only</span><span class="o">=</span>on<span class="p">;</span></p>

<pre><code>    server_name poyi.com&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    passenger_enabled on&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    rails_env    production&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    root         /home/bob/poyi/public&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;# redirect server error pages to the static page /50x.html&lt;/span&gt;
    error_page   &lt;span class=&quot;m&quot;&gt;500&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;502&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;503&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;504&lt;/span&gt;  /50x.html&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; /50x.html &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        root   html&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;# 註解掉&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;# root /var/www/html;&lt;/span&gt;
</code></pre>

<p><span class="o">}</span></code></pre></div>
<h2 id="install-mysql">Install Mysql</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo apt-get install mysql-server mysql-client libmysqlclient-dev</code></pre></div>
<h2 id="install-redis">Install Redis</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo apt-get update
sudo apt-get install build-essential tcl</p>

<p><span class="nb">cd</span> /tmp
curl -O <a href="http://download.redis.io/redis-stable.tar.gz">http://download.redis.io/redis-stable.tar.gz</a>
tar xzvf redis-stable.tar.gz
<span class="nb">cd</span> redis-stable
make
make <span class="nb">test</span>
sudo make install</p>

<p>sudo mkdir /etc/redis
sudo cp /tmp/redis-stable/redis.conf /etc/redis</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 修改/etc/redis/redis.conf</span>
<span class="c1"># 兩個地方要改</span>
supervised systemd
dir /var/lib/redis</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 新增/etc/systemd/system/redis.service</span>
<span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Redis In-Memory Data Store
<span class="nv">After</span><span class="o">=</span>network.target</p>

<p><span class="o">[</span>Service<span class="o">]</span>
<span class="nv">User</span><span class="o">=</span>redis
<span class="nv">Group</span><span class="o">=</span>redis
<span class="nv">ExecStart</span><span class="o">=</span>/usr/local/bin/redis-server /etc/redis/redis.conf
<span class="nv">ExecStop</span><span class="o">=</span>/usr/local/bin/redis-cli shutdown
<span class="nv">Restart</span><span class="o">=</span>always</p>

<p><span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 新增redis user並給權限</span>
sudo adduser &ndash;system &ndash;group &ndash;no-create-home redis
sudo mkdir /var/lib/redis
sudo chown redis:redis /var/lib/redis
sudo chmod <span class="m">770</span> /var/lib/redis</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo systemctl <span class="nb">enable</span> redis <span class="c1"># 設定開機啟動</span>
sudo systemctl start redis
sudo systemctl stop redis
sudo systemctl status redis</code></pre></div>
<h2 id="install-ssdb">Install SSDB</h2>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">wget &ndash;no-check-certificate <a href="https://github.com/ideawu/ssdb/archive/master.zip">https://github.com/ideawu/ssdb/archive/master.zip</a>
unzip master
<span class="nb">cd</span> ssdb-master
make
sudo make install</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="c1"># 新增/etc/systemd/system/ssdb.service</span>
<span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>SSDB
<span class="nv">After</span><span class="o">=</span>network.target</p>

<p><span class="o">[</span>Service<span class="o">]</span>
<span class="nv">LimitCORE</span><span class="o">=</span>infinity
<span class="nv">LimitNOFILE</span><span class="o">=</span><span class="m">100000</span>
<span class="nv">LimitNPROC</span><span class="o">=</span><span class="m">100000</span>
<span class="nv">PIDFile</span><span class="o">=</span>/usr/local/ssdb/var/ssdb.pid
<span class="nv">WorkingDirectory</span><span class="o">=</span>/usr/local/ssdb
<span class="nv">ExecStart</span><span class="o">=</span>/usr/local/ssdb/ssdb-server /usr/local/ssdb/ssdb.conf -s restart -d
<span class="nv">ExecStop</span><span class="o">=</span>/usr/local/ssdb/ssdb-server /usr/local/ssdb/ssdb.conf -s stop -d
<span class="nv">Type</span><span class="o">=</span>forking
<span class="nv">KillMode</span><span class="o">=</span>none
<span class="nv">Restart</span><span class="o">=</span>on-failure
<span class="nv">RestartSec</span><span class="o">=</span>10s
<span class="nv">User</span><span class="o">=</span>root</p>

<p><span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">sudo systemctl <span class="nb">enable</span> ssdb <span class="c1"># 設定開機啟動</span>
sudo systemctl start ssdb
sudo systemctl stop ssdb
sudo systemctl status ssdb</code></pre></div>
<h3 id="這邊先跳過-capistrano-deploy">這邊先跳過 capistrano deploy</h3></p>

<p>Reference:</p>

<p><a href="https://gorails.com/deploy/ubuntu/16.04">https://gorails.com/deploy/ubuntu/16.04</a></p>


    </main>
  </div>
  <footer>
    <div class="footer-wrapper">
      <p>Made with ❤️ &mdash; Powered by <a href="https://gohugo.io/" target="_blank" rel="external">Hugo</a> and the <a href="https://github.com/bjacquemet/personal-web" target='_blank' rel="external">Personal Web</a> theme.</p>
      <p></p>
    </div>
  </footer>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:500,600|Raleway:400,400i,600" rel="stylesheet">
  
</body>
</html>
